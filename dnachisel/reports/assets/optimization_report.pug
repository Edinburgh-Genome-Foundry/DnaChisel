#sidebar: p Generated by DnaChisel version {{ version }} on {{ pdf_tools.now() }}

.logos
  img(src="file:///{{ dnachisel_logo_url }}" style="height:25px; width: auto")
  img(src="file:///{{ egf_logo_url }}" style="height:25px; width: auto")


h1(style='margin-top: -0.2cm;') Optimization Report
h2.subtitle #[span.grey for] {{ project_name }}
if file_hash
  h6(style="text-align: center; margin-top: 0; color: #ccc; font-size: 1.3em") File hash {{ file_hash }}

div(style="margin-top:1cm; margin-bottom:1cm;")
  div(style="width: 20%; display: inline-block")
    if constraints_evaluations.all_evaluations_pass()
      p(style="text-align:center;")
        i.check.circle.icon(style='font-size: 55px;')
        br
        b(style='font-size: 22px;') Success!
    else
      p(style="text-align:center;")
        i.exclamation.icon(style='font-size: 55px;')
        br
        b(style='font-size: 22px;') Failed!
  div(style="text-align:center; width: 70%; display: inline-block;")
    table.ui.very.basic.definition.compact.table(style="text-align:center;")
      thead
        th
        th Failing constraints
        th Objectives score
        th Sequenticon
      tr
        td(style='background: none') Before
        td= len( problem.constraints_before.filter('failing') )
        td= problem.objectives_before.scores_sum(as_text=True)
        td !{sequenticons['before']}
      tr
        td(style='background: none') After
        td= len( constraints_evaluations.filter('failing') )
        td= objectives_evaluations.scores_sum(as_text=True)
        td !{sequenticons['after']}

if constraints_evaluations.all_evaluations_pass()
  if diffs_figure_data
    img#diff-figure(src="{{ diffs_figure_data }}")
  else
    p(style='font-size: 8px').
      Note: install Geneblocks to see a friendly plot of sequence edits here.
      (pip install geneblocks)
p The optimization created {{edits}} edits. See attached Genbank file for the details.

h2.section Constraints
{{ pdf_tools.dataframe_to_html(constraints_before_after, extra_classes=('ui', 'very', 'basic', 'compact', 'table'), use_default_classes=False) }}


h2.section Objectives
{{ pdf_tools.dataframe_to_html(objectives_before_after, extra_classes=('ui', 'very', 'basic', 'compact', 'table'), use_default_classes=False) }}

style.
  img#diff-figure {
    display: block;
    max-width: 100% !important;
    max-height: 11.5cm !important;
    margin: 0 auto;
  }
  .stats {
    transform: scale(0.6);
    margin-top: -2em;
  }
  h1 {
    margin-bottom: 0 !important;
  }
  .subtitle {
    text-align: center;
    margin-top: 0 !important;
    margin-bottom: 0 !important;
  }
  .grey {
    color: #aaa
  }
  table.ui {
    text-align: center;
  }